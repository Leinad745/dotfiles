{"version":2,"initialFileContents":[["file:///home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol","a6637c5"]],"timeline":{"checkpoints":[{"checkpointId":"abb31cae-4f46-4a4a-8d25-288954c57701","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"54228555-35ed-432f-b04b-91b13e4474ce","requestId":"request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6","epoch":1,"label":"Request request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6"}],"currentEpoch":4,"fileBaselines":[["file:///home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol::request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6",{"uri":{"$mid":1,"fsPath":"/home/5ub4k3m1/ciberseguridad/htb/CTFs/Try Out/blockchain_notademocraticelection/NotADemocraticElection.sol","external":"file:///home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol","path":"/home/5ub4k3m1/ciberseguridad/htb/CTFs/Try Out/blockchain_notademocraticelection/NotADemocraticElection.sol","scheme":"file"},"requestId":"request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6","content":"pragma solidity 0.8.25;\n\ncontract NotADemocraticElection {\n    // ****************************************************\n    // ******* NOTE: THIS NOT A DEMOCRATIC ELECTION *******\n    // ****************************************************\n\n    uint256 constant TARGET_VOTES = 1000e18;\n\n    struct Party {\n        string  fullname;\n        uint256 totalvotes;\n    }\n    struct Voter {\n        uint256 weight;\n        address addr;\n    }\n\n    mapping(bytes3 _id => Party) public parties;\n    mapping(bytes _sig => Voter) public voters;\n    mapping(string _name => mapping(string _surname => address _addr)) public uniqueVoters;\n    bytes3 public winner;\n\n    event Voted(\n        address _voter,\n        bytes3  _party\n    );\n    event VoterDeposited(\n        address _voter,\n        uint256 _weight\n    );\n    event ElectionWinner(\n        bytes3 _party\n    );\n\n    constructor(\n       bytes3 _partyAsymbol , string memory _partyAfullname,\n       bytes3 _partyBsymbol , string memory _partyBfullname\n    ) {\n        parties[_partyAsymbol].fullname = _partyAfullname;\n        parties[_partyBsymbol].fullname = _partyBfullname;\n    }\n\n    function getVotesCount(bytes3 _party) public view returns (uint256) {\n        return parties[_party].totalvotes;\n    }\n    \n    function getVoterSig(string memory _name, string memory _surname) public pure returns (bytes memory) {\n        return abi.encodePacked(_name, _surname);\n    }\n\n    function checkWinner(bytes3 _party) public {\n        if (parties[_party].totalvotes >= TARGET_VOTES) {\n            winner = _party; \n            emit ElectionWinner(_party);\n        }\n    }\n\n    function depositVoteCollateral(string memory _name, string memory _surname) external payable {\n        require(uniqueVoters[_name][_surname] == address(0), \"Already deposited\");\n\n        bytes memory voterSig = getVoterSig(_name, _surname);\n        voters[voterSig].weight += msg.value;\n        uniqueVoters[_name][_surname] = msg.sender;\n\n        emit VoterDeposited(msg.sender, msg.value);\n    }\n\n    function vote(\n        bytes3 _party,\n        string memory _name,\n        string memory _surname\n    ) public {\n        require(uniqueVoters[_name][_surname] == msg.sender, \"You cannot vote on behalf of others.\");\n\n        bytes memory voterSig = getVoterSig(_name, _surname);\n        uint256 voterWeight = voters[voterSig].weight == 0 ? 1 : voters[voterSig].weight;\n        parties[_party].totalvotes += 1 * voterWeight;\n        \n        emit Voted(msg.sender, _party);\n        checkWinner(_party);\n    }\n}","epoch":2,"telemetryInfo":{}}]],"operations":[{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/5ub4k3m1/ciberseguridad/htb/CTFs/Try Out/blockchain_notademocraticelection/NotADemocraticElection.sol","external":"file:///home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol","path":"/home/5ub4k3m1/ciberseguridad/htb/CTFs/Try Out/blockchain_notademocraticelection/NotADemocraticElection.sol","scheme":"file"},"requestId":"request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6","epoch":3,"edits":[{"text":"pragma solidity ^0.8.25;\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":2,"endColumn":1}}]}],"epochCounter":4},"recentSnapshot":{"entries":[{"resource":"file:///home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol","languageId":"solidity","originalHash":"a6637c5","currentHash":"a6637c5","state":2,"snapshotUri":"chat-editing-snapshot-text-model:/home/5ub4k3m1/ciberseguridad/htb/CTFs/Try%20Out/blockchain_notademocraticelection/NotADemocraticElection.sol?%7B%22session%22%3A%7B%22%24mid%22%3A1%2C%22external%22%3A%22vscode-chat-session%3A%2F%2Flocal%2FNzY5MTQ2YmYtZDkzOS00ZDc3LWFkNzktNWMyZjk0NWE1Y2Y3%22%2C%22path%22%3A%22%2FNzY5MTQ2YmYtZDkzOS00ZDc3LWFkNzktNWMyZjk0NWE1Y2Y3%22%2C%22scheme%22%3A%22vscode-chat-session%22%2C%22authority%22%3A%22local%22%7D%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_8b6a62a7-d0d6-4a1a-9410-6375a7263af6","agentId":"github.copilot.editingSessionEditor","command":"fix","modelId":"copilot/auto","modeId":"ask"}}]}}